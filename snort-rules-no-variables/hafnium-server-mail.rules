alert tcp 1.1.1.1 any -> 10.0.0.1 80 ( msg:"SERVER-MAIL Microsoft Exchange Server certificate leak attempt"; flow:to_server,established; http_uri; content:"/DDI/DDIService.svc/SetObject",nocase; content:"ExportCertificate",fast_pattern,nocase; content:"msExchEcpCanary=",nocase; http_client_body; content:"|22|FileName|22|",nocase; pcre:"/\x22FileName\x22\s*\x3a\s*\x22(?(?!(?<!\x5c)\x22).)*?[\x2f\x5c]{2}(ClientAccess|wwwroot)[\x2f\x5c]{2}/i"; metadata:policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:http; reference:cve,2021-24085; reference:url,portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2021-24085; reference:url,srcincite.io/advisories/src-2021-0004/; classtype:attempted-admin; sid:57251; rev:1; )
alert tcp 1.1.1.1 any -> 10.0.0.1 80 ( msg:"SERVER-MAIL Microsoft Exchange Server arbitrary file write attempt"; flow:to_server,established; http_uri; content:"/DDIService.svc/SetObject",fast_pattern,nocase; content:"VirtualDirectory",nocase; http_client_body; content:"ExternalUrl",nocase; metadata:policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop,ruleset community; service:http; reference:cve,2021-27065; reference:url,portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2021-27065; classtype:attempted-admin; sid:57252; rev:1; )
alert tcp 1.1.1.1 any -> 10.0.0.1 80 ( msg:"SERVER-MAIL Microsoft Exchange Server arbitrary file write attempt"; flow:to_server,established; http_uri; content:"/DDIService.svc/SetObject",fast_pattern,nocase; content:"VirtualDirectory",nocase; http_client_body; content:"FilePathName",nocase; metadata:policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop,ruleset community; service:http; reference:cve,2021-27065; reference:url,portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2021-27065; classtype:attempted-admin; sid:57253; rev:1; )
