alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS ( msg:"MALWARE-CNC Html.Webshell.Hafnium inbound request attempt"; flow:to_server,established; http_uri; content:"/owa/auth",fast_pattern,nocase; content:".aspx",nocase; http_client_body; content:"p=",nocase; content:"c=",nocase; http_uri; pcre:"/\x2f(web|help|document|error(EEE?|EW|FF)|healthcheck|aspnet_(www|client|iisstart)|xx|shell|one)\x2easpx/i"; metadata:impact_flag red,policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:http; reference:url,www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/; classtype:trojan-activity; sid:57235; rev:1; )
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS ( msg:"MALWARE-CNC Html.Webshell.Hafnium inbound request attempt"; flow:to_server,established; http_uri; content:"/owa/auth",fast_pattern,nocase; content:".aspx",nocase; content:"p=",nocase; content:"c=",nocase; pcre:"/\x2f(web|help|document|error(EEE?|EW|FF)|healthcheck|aspnet_(www|client|iisstart)|xx|shell|one)\x2easpx/i"; metadata:impact_flag red,policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:http; reference:url,www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/; classtype:trojan-activity; sid:57236; rev:1; )
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS ( msg:"MALWARE-CNC Html.Webshell.Hafnium inbound request attempt"; flow:to_server,established; http_uri; content:"/owa/auth",fast_pattern,nocase; content:".aspx",nocase; http_cookie; content:"p=",nocase; content:"c=",nocase; http_uri; pcre:"/\x2f(web|help|document|error(EEE?|EW|FF)|healthcheck|aspnet_(www|client|iisstart)|xx|shell|one)\x2easpx/i"; metadata:impact_flag red,policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:http; reference:url,www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/; classtype:trojan-activity; sid:57237; rev:1; )
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS ( msg:"MALWARE-CNC Html.Webshell.Hafnium inbound request attempt"; flow:to_server,established; http_uri; content:"/aspnet_client/",fast_pattern,nocase; content:".aspx",nocase; content:"p=",nocase; content:"c=",nocase; pcre:"/\x2f(web|help|document|error(EEE?|EW|FF)|healthcheck|aspnet_(www|client|iisstart)|xx|shell|one)\x2easpx/i"; metadata:impact_flag red,policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:http; reference:url,www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/; classtype:trojan-activity; sid:57238; rev:1; )
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS ( msg:"MALWARE-CNC Html.Webshell.Hafnium inbound request attempt"; flow:to_server,established; http_uri; content:"/aspnet_client/",fast_pattern,nocase; content:".aspx",nocase; http_client_body; content:"p=",nocase; content:"c=",nocase; http_uri; pcre:"/\x2f(web|help|document|error(EEE?|EW|FF)|healthcheck|aspnet_(www|client|iisstart)|xx|shell|one)\x2easpx/i"; metadata:impact_flag red,policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:http; reference:url,www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/; classtype:trojan-activity; sid:57239; rev:1; )
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS ( msg:"MALWARE-CNC Html.Webshell.Hafnium inbound request attempt"; flow:to_server,established; http_uri; content:"/aspnet_client/",fast_pattern,nocase; content:".aspx",nocase; http_cookie; content:"p=",nocase; content:"c=",nocase; http_uri; pcre:"/\x2f(web|help|document|error(EEE?|EW|FF)|healthcheck|aspnet_(www|client|iisstart)|xx|shell|one)\x2easpx/i"; metadata:impact_flag red,policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:http; reference:url,www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/; classtype:trojan-activity; sid:57240; rev:1; )
